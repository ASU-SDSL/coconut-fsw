<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Coconut CubeSat: Coconut Flight-Software</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Coconut CubeSat
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Coconut Flight-Software</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="coconut-flight-software-1"></a></p>
<h2><a class="anchor" id="table-of-contents"></a>
Table of Contents</h2>
<ul>
<li><a class="el" href="index.html#coconut-flight-software">Coconut Flight-Software</a><ul>
<li><a class="el" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
</ul>
<p><a class="el" href="#introduction">Introduction</a></p><ul>
<li><a class="el" href="#project-origins-and-goals">Project Origins and Goals</a></li>
<li><a class="el" href="#flight-heritage">Flight Heritage</a></li>
<li><a class="el" href="#coconut-hardware-overview">Coconut Hardware Overview</a></li>
<li><a class="el" href="#current-software-capabilities-and-features">Current Software Capabilities and Features</a></li>
</ul>
<p><a class="el" href="#fsw-architecture-design">FSW Architecture Design</a></p><ul>
<li><a class="el" href="#tools-and-libraries">Tools and Libraries</a></li>
</ul>
<p><a class="el" href="#repository-overview-and-structure">Repository Overview and Structure</a></p><ul>
<li><a class="el" href="#tasksthreads-overview">Tasks/Threads Overview</a></li>
</ul>
<p><a class="el" href="#users-guide">Users Guide</a></p><ul>
<li><a class="el" href="#cloning-and-building">Cloning and Building</a></li>
<li><a class="el" href="#debugging">Debugging</a></li>
<li><a class="el" href="#using-the-simulator">Using the Simulator</a></li>
<li><a class="el" href="#creating-device-drivers">Creating Device Drivers</a></li>
<li><a class="el" href="#creating-telemetry-points">Creating Telemetry Points</a></li>
<li><a class="el" href="#creating-new-steve-jobs">Creating New STEVE Jobs</a></li>
</ul>
<p><a class="el" href="#interacting-with-the-filesystem">Interacting with the Filesystem</a></p>
<h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<h2><a class="anchor" id="project-origins-and-goals"></a>
Project Origins and Goals</h2>
<p>The Coconut Flight-Software was developed for the 1U Coconut CubeSat built by the Sun Devil Satellite Lab student group in collaboration with the Interplanetary Initiative Lab at Arizona State University. The Coconut CubeSat is a 1U LoRa-based store-and-forwarding satellite. The main goal of the project was to work with educational groups to create small, inexpensive ground stations around the world that would do some kind of data collection and the Coconut CubeSat would translate that data back to ASU. Most of the satellite was designed and built in-house by the student team using readily available parts and electrical components. The flight software resides on the main microcontroller, the RP2040 (the same chip on the Raspberry Pi Pico). See the <a class="el" href="#coconut-hardware-overview">Coconut Hardware Overview</a> for more details on the flight hardware. The goals of the Flight Software were to interact with all sensors and devices on-board Coconut's custom hardware, as well as run multiple unique tasks such as transmitting a heartbeat/beacon telemetry signal, deploy antenna elements, and store user data. A full list of capabilities are listed under the <a class="el" href="#current-software-capabilities-and-features">Current Software Capabilities and Features</a> section. The #1 goal of the project is to make the software as safe and reliable as possible to minimize possibilities of failures during satellite operation.</p>
<p>For further questions please reach out to the Interplanetary Initiative Lab at ASU or any of our student members:</p><ul>
<li>Interplanetary Initiative Lab: <a href="#" onclick="location.href='mai'+'lto:'+'iil'+'ab'+'@as'+'u.'+'edu'; return false;">iilab<span class="obfuscator">.nosp@m.</span>@asu<span class="obfuscator">.nosp@m.</span>.edu</a></li>
<li>Dylan Larson (project lead and software engineer): <a href="#" onclick="location.href='mai'+'lto:'+'dll'+'ar'+'so4'+'@a'+'su.'+'ed'+'u'; return false;">dllar<span class="obfuscator">.nosp@m.</span>so4@<span class="obfuscator">.nosp@m.</span>asu.e<span class="obfuscator">.nosp@m.</span>du</a></li>
<li>Tyler Nielsen (software subsystem team lead): <a href="#" onclick="location.href='mai'+'lto:'+'tmn'+'ie'+'ls3'+'@a'+'su.'+'ed'+'u'; return false;">tmnie<span class="obfuscator">.nosp@m.</span>ls3@<span class="obfuscator">.nosp@m.</span>asu.e<span class="obfuscator">.nosp@m.</span>du</a></li>
<li>Mitchell Zakocs (honorary software subsystem team lead): <a href="#" onclick="location.href='mai'+'lto:'+'mza'+'ko'+'cs@'+'as'+'u.e'+'du'; return false;">mzako<span class="obfuscator">.nosp@m.</span>cs@a<span class="obfuscator">.nosp@m.</span>su.ed<span class="obfuscator">.nosp@m.</span>u</a></li>
</ul>
<h2><a class="anchor" id="flight-heritage"></a>
Flight Heritage</h2>
<p>This is a growing list of projects and satellites that this flight software has flown on or will be flown on in the future.</p><ul>
<li>Coconut CubeSat - Arizona State University (Launch Q4 2025)</li>
<li>SquidSat CubeSat - Arizona State University (Launch TBD)</li>
</ul>
<h2><a class="anchor" id="coconut-hardware-overview"></a>
Coconut Hardware Overview</h2>
<p>The Coconut Electrical hardware includes the following components/systems that the flight software interacts with: <b>Flight Control Board (FCR):</b></p><ul>
<li>RP2040 microcontroller: where the flight software runs</li>
<li>MAX706RESA: watchdog</li>
<li>2 LoRa radios (1 for redundancy; output controlled by a switch): HopeRF RFM98PW and NiceRF LoRa1278F30</li>
<li>2 MRAM chips: 1 for storing the code instructions (FSW) and 1 for the filesystem/mission data</li>
<li>Magnetometer: LIS3MDLTR</li>
<li>Real-time clock: DS3231</li>
</ul>
<p><b>Electrical Power System board (EPS):</b></p><ul>
<li>Battery gauge sensor: MAX17048</li>
<li>Multiple INA219 sensors: current and voltage sensors</li>
<li>Multiple one-wire DS18B temperature sensors</li>
</ul>
<p><b>Deployable Antenna:</b></p><ul>
<li>Custom deployable antenna triggered by both I2C and GPIO (redundant controls)</li>
</ul>
<h2><a class="anchor" id="current-software-capabilities-and-features"></a>
Current Software Capabilities and Features</h2>
<p>The following list is an overview of the current features included in this repository. This list should be updated as updates are released.</p>
<p>Device drivers:</p><ul>
<li>MAX17048</li>
<li>HopeRF and NiceRF radio interface (RadioLib is supported for other radios as well)</li>
<li>LIS3MDLTR</li>
<li>DS3231</li>
<li>MAX17048</li>
<li>INA219</li>
<li>DS18B (in development)</li>
<li>MAX706RESA</li>
</ul>
<p>Capabilities:</p><ul>
<li>Task/function scheduling (run a function at a certain time with scheduling)</li>
<li>CCSDS Space Packet encoding/decoding for telemetry and commands</li>
<li>Sending/receiving telemetry and commands on both radio interfaces and Ground-Support Interface hard-wire interface (GSE - when you see GSE it refers to this UART hardware interface)</li>
<li>Sensor data collection and telemetry packet creation for the heartbeat/beacon</li>
<li>Filesystem for creating directories, files, as well as reading from files</li>
<li>Command authentication (unique 8-byte token for each user)</li>
<li>Simulation on Linux</li>
<li>Fuzzing</li>
<li>Unit testing</li>
<li>Hardware and simulator debugging through gdb</li>
</ul>
<h1><a class="anchor" id="fsw-architecture-design"></a>
FSW Architecture Design</h1>
<h2><a class="anchor" id="tools-and-libraries"></a>
Tools and Libraries</h2>
<p>The Flight Software is built upon the C <a href="https://www.raspberrypi.com/documentation/pico-sdk/">Pico-SDK</a> and FreeRTOS.</p><ul>
<li>Pico-SDK: Raspberry Pi Pico library for interfacing with the Raspberry Pi Pico hardware, such as GPIO lines, hardware communications (I2C, UART, SPI), etc.</li>
<li>FreeRTOS: Real-Time Operating System that we used to allow for multiple threads (AKA tasks) to run multiple different tasks at once in the FSW</li>
</ul>
<p>Some other libraries utilized in this repo:</p><ul>
<li>FatFS: Used to put a FatFS on the MRAM chips</li>
<li>libspacepacket: custom library for CCSDS space packet processing</li>
<li>RadioLib: Arduino C++ library for interfacing with many radio modules, including both of our LoRa radio modules. Uses the <a class="el" href="PicoHal_8h.html" title="Adapted from RadioLib&#39;s provided PicoHal.">PicoHal.h</a> file to convert Arduino functions to pico-sdk functions, taken from <a href="https://github.com/jgromes/RadioLib/tree/master/examples/NonArduino/Pico">RadioLib</a></li>
<li><a href="https://github.com/mzakocs/AFLplusplus_ultimate_protobuf_mutator">AFLplusplus_ultimate_protobuf_mutator</a>: Used to create a more effective structured input fuzzer for the flight software</li>
</ul>
<h1><a class="anchor" id="repository-overview-and-structure"></a>
Repository Overview and Structure</h1>
<div class="fragment"><div class="line">coconut-fsw</div>
<div class="line">│   deploy.sh - builds the flight software and deploys it to an RP2040 automatically</div>
<div class="line">|   docker_build.sh - build using Docker - not well tested</div>
<div class="line">|   pico_sdk_import.cmake - taken from the pico-sdk</div>
<div class="line">│</div>
<div class="line">└───lib - contains all external libraries</div>
<div class="line">│   </div>
<div class="line">└───main - contains all code we wrote</div>
<div class="line">│   └───drivers - all code used to interact with sensors or devices</div>
<div class="line">│   └───tasks - every C file here has a function that is ran as an RTOS task/thread</div>
<div class="line">|   └───utilities - any code used apart from drivers and tasks</div>
<div class="line">|   └───simulator - stubbed files and functions for the simulator</div>
<div class="line">|   └───test - unit tests and fuzzers</div>
</div><!-- fragment --><h2><a class="anchor" id="tasksthreads-overview"></a>
Tasks/Threads Overview</h2>
<p>Under the <code>main/tasks</code> directory, you will find multiple tasks. The <code><a class="el" href="main_8c.html">main.c</a></code> file calls each function as a task, so you can see all of the different functions running as a task. Every other C file in this directory has a function that is ran as a task by the main function. See the relative header files for API interfaces to these tasks. Physical sensor or device interactions are controlled by a single task to avoid race conditions. These tasks/threads have the following responsibilities:</p><ul>
<li><b>Filesystem Task:</b> Initializes the filesystem on the MRAM and provides the API for interacting with the filesystem</li>
<li><b>GSE Task:</b> Handles commands and telemetry communication over the UART hardline interface (the same commands/telemetry as the radio, just a redundant hardline interface)</li>
<li><b>Radio Task:</b> Handles commands and telemetry communication over both of the radios and control of the RF switch to switch between radios</li>
<li><b>Command Task:</b> Receives raw bytes of commands from either the Radio or GSE tasks (from the ground) and parses the CCSDS header to find where to route the message to.</li>
<li><b>Telemetry Task:</b> Receives packets from any task to encapsulate in a space packet and sends to the GSE and Radio Task. This header file also includes the definitions for all telemetry packets. The "log()" functions and all variants are also transmitted over GSE only as a space packet so that both debug messages and telemetry/commands can be used over the same interface.</li>
<li><b>STEVE (Scheduler Task):</b> STEVE handles scheduling of functions (called "jobs") to execute at certain times, for instance the heartbeat/beacon executing every 30 seconds, or the antenna deployment executing 30 minutes after launch. The <code>jobs</code> directory also includes the heartbeat job, where telemetry points can be added or removed. This is executed every 30 seconds but can be changed in the <code><a class="el" href="heartbeat__job_8h.html">heartbeat_job.h</a></code> file.</li>
</ul>
<p><br  />
 </p><center>A Figure of the overall system and some of the tasks in the flight software <img src="fsw-bd.png" alt="" width="800" class="inline"/> <br  />
<br  />
 A Figure of the ground software and the radio/GSE redundancy</center><center><img src="gsw-bd.png" alt="" width="800" class="inline"/> </center><h1><a class="anchor" id="users-guide"></a>
Users Guide</h1>
<h2><a class="anchor" id="cloning-and-building"></a>
Cloning and Building</h2>
<p>To setup this repository, you can follow these steps:</p><ol type="1">
<li>Install dependencies: <code>sudo apt install -y python3 cmake gcc-arm-none-eabi build-essential git</code></li>
<li>Clone with submodules (submodules contains all external libraries including the pic_sdk and freertos): <code>git clone --recurse-submodules <a href="https://github.com/ASU-SDSL/coconut-fsw">https://github.com/ASU-SDSL/coconut-fsw</a></code></li>
<li>Build and deploy the firmware to the RP2040<ol type="a">
<li>Hold the white <code>BOOTSEL</code> button on the RP2040</li>
<li>Connect the RP2040 to your computer with Micro-USB</li>
<li>Let go of the <code>BOOTSEL</code> button</li>
<li>A USB flashdrive called <code>RPI-RP2</code> should connect to your computer</li>
<li>Run <code>./deploy.sh</code> - this will also build the firmware</li>
<li>The codebase will now be running on the board. It will boot back into the flashed firmware even if powered off and powered on again</li>
</ol>
</li>
<li>If you wish to just build and not deploy, run <code>./build.sh</code> - this will generate the <code>./build/</code> directory where you can find the uf2 executable under <code>./build/Debug/main/COCONUTFSW.uf2</code>. You can also check the contents of the scripts to find out how to build the simulator</li>
</ol>
<h2><a class="anchor" id="debugging"></a>
Debugging</h2>
<p>For debugging, you have two options:</p><ol type="1">
<li>Printing to the debug log<ol type="a">
<li>Run <code>ls /dev</code> and look for <code>ttyACM0</code> or <code>ttyACM1</code></li>
<li>Run <code>debug/ACM0.sh</code> or <code>debug/ACM1.sh</code> to see the log</li>
<li>You will see any output from <code>logln_info</code> and <code>printf</code> calls in your code</li>
</ol>
</li>
<li>Debugging through SWD/JTAG<ol type="a">
<li>See <code>debug/README.md</code> to use the VSCode graphic debugger to set breakpoints and see variable values as your code executes</li>
</ol>
</li>
</ol>
<h2><a class="anchor" id="using-the-simulator"></a>
Using the Simulator</h2>
<p>The simulator will simulate FreeRTOS as well as many pico sdk functions, you can see the implemented pico-sdk functions and change their simulated implementations under main/simulator/pico-sdk. The filesystem is also fully functional in the simulator. You can start the simulator using the "Coconut Simulator Debug" under the VSCode debugging window. To utilize telemetry and commands on the simulator with the host computer, the following can be done:</p><ul>
<li>In a terminal, run <code>socat -d -d pty,raw,echo=0 pty,raw,echo=0</code> - this will create 2 /dev/pts/ ports, which will route each others' inputs to the output of the other</li>
<li>Once the simulator executable is built (can be done with <code>./deploy.sh -b -s</code>), you can run <code>./build/Simulator/main/COCONUTFSW &gt; /dev/pts/{x} &lt; /dev/pts/{x}</code> where {x} is the number of one of the ports created above</li>
<li>You can then use any other program to read and write to the <em>other</em> pts port just like you would a UDP or serial port</li>
</ul>
<h2><a class="anchor" id="creating-device-drivers"></a>
Creating Device Drivers</h2>
<p>These device drivers are not live programs/threads, but rather a small library to interface with a certain device or sensor. Every device driver has a <code>.h</code> file under <code>main/drivers/inc</code> and a <code>.c</code> file under <code>main/drivers/src</code>. Documentation for the device is to be kept in the <code>.h</code> file. Drivers are usually named after the sensor/device name or part number. Once the header and C file are complete, they can be added in the CMake compilation process doing the following:</p>
<p>Edit <code>main/CMakeLists.txt</code> - the <code>.../inc</code> directory is already included, so the C file is the only one that needs to be added:</p>
<div class="fragment"><div class="line"><span class="preprocessor">## Create a sources variable with a link to all cpp files to compile</span></div>
<div class="line">set(SOURCES</div>
<div class="line">    ${MAIN_DIRECTORY}/tasks/<a class="code hl_function" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>/<a class="code hl_function" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>.c</div>
<div class="line">    ${MAIN_DIRECTORY}/tasks/gse/gse.c</div>
<div class="line">    ${MAIN_DIRECTORY}/tasks/steve/steve.c</div>
<div class="line">    ...</div>
<div class="line">    ${MAIN_DIRECTORY}/drivers/src/your_new_sensor.c</div>
<div class="line">)</div>
<div class="ttc" id="amain_8c_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> main.c:40</div></div>
</div><!-- fragment --><p>Then the header file can be used in an <code>#include</code> anywhere throughout the FSW.</p>
<h2><a class="anchor" id="creating-telemetry-points"></a>
Creating Telemetry Points</h2>
<p>If you want to include new telemetry points/sensor values to the heartbeat/beacon packet, that can be done in the <code><a class="el" href="heartbeat__job_8c.html">heartbeat_job.c</a></code> and <code><a class="el" href="telemetry_8h.html" title="Functions for packaging and queuing telemetry packets for sending.">telemetry.h</a></code> files. Under <code><a class="el" href="telemetry_8h.html" title="Functions for packaging and queuing telemetry packets for sending.">main/tasks/telemetry/telemetry.h</a></code>, you can add telemetry values to the <code>heartbeat_telemetry_t</code> struct:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_function" href="command_8h.html#ad09246453a4dabd919c7541484046a87">__attribute__</a>((__packed__)) {</div>
<div class="line">    uint8_t state;</div>
<div class="line">    uint32_t uptime;</div>
<div class="line">    uint8_t hour;</div>
<div class="line">    uint8_t minute;</div>
<div class="line">    ...</div>
<div class="line">    uint8_t new_sensor_value;</div>
<div class="line">} <a class="code hl_variable" href="telemetry_8h.html#a4b5fd07584ec6ff00b93f4ce4141a20a">heartbeat_telemetry_t</a>;</div>
<div class="ttc" id="acommand_8h_html_ad09246453a4dabd919c7541484046a87"><div class="ttname"><a href="command_8h.html#ad09246453a4dabd919c7541484046a87">__attribute__</a></div><div class="ttdeci">struct __attribute__((__packed__))</div><div class="ttdoc">Heartbeat packet definition.</div><div class="ttdef"><b>Definition</b> command.h:57</div></div>
<div class="ttc" id="atelemetry_8h_html_a4b5fd07584ec6ff00b93f4ce4141a20a"><div class="ttname"><a href="telemetry_8h.html#a4b5fd07584ec6ff00b93f4ce4141a20a">heartbeat_telemetry_t</a></div><div class="ttdeci">heartbeat_telemetry_t</div><div class="ttdef"><b>Definition</b> telemetry.h:101</div></div>
</div><!-- fragment --><p>Then the value of that for each beacon packet will be found/measured/calculated in the <code><a class="el" href="heartbeat__job_8c.html">main/tasks/steve/jobs/heartbeat_job.c</a></code> <code><a class="el" href="heartbeat__job_8c.html#a5a39a53ceb61fec283d89fcb0032a24b" title="Collects sensor information and transmits it as a heartbeat packet.">heartbeat_telemetry_job()</a></code> function. Any invalid values or telemetry points that might return errors in their acquirement are set to max values (ex. if there is an error finding a uint8_t value, the value will be 0xff), this is to not confuse invalid values with real measurements as most telemetry values will not reach their max values. This function will also show how to utilize the telemetry task API to transmit telemetry packets and can be copied for new packets.</p>
<h2><a class="anchor" id="creating-new-steve-jobs"></a>
Creating New STEVE Jobs</h2>
<p>See the <code><a class="el" href="steve_8h.html" title="S.T.E.V.E (Scheduler Task for Executing Vital Events)">main/tasks/steve/steve.h</a></code> for the API into the STEVE task, as well as the heartbeat job for reference. To add a new recurring task, follow the heartbeat job's example. Create a new h and c file for the new job under <code>.../jobs</code> with the function and implementation. Each header file for a job should have a <code>recurring time</code> and a <code>name</code> along with the function to execute. Ex: </p><div class="fragment"><div class="line"><span class="preprocessor">#define EXAMPLE_JOB_NAME &quot;example_job&quot;</span></div>
<div class="line"><span class="preprocessor">#define EXAMPLE_JOB_DEFAULT_INTERVAL 5 </span><span class="comment">// in seconds</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> example_job(<span class="keywordtype">void</span>* unused);</div>
</div><!-- fragment --><p>The C file will contain the implementation for the function, and the function/job can then be scheduled anywhere, but if you wish to have it execute throughout the FSW's lifetime, you can schedule it at the initialization of STEVE in <code><a class="el" href="steve_8c.html">steve.c</a></code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="steve_8c.html#a7eb0cd293c468c08d67c90a8ace5448c">initialize_steve</a>() {</div>
<div class="line">    <span class="comment">// Initialize scheduler job mutex</span></div>
<div class="line">    <a class="code hl_variable" href="steve_8h.html#a598c2d1bb858ac5a4ca951addc49cb1e">g_steve_context</a>.mutex = xSemaphoreCreateMutex();</div>
<div class="line">    <span class="comment">// Initialize state</span></div>
<div class="line">    <a class="code hl_variable" href="state_8h.html#ab3c4a3401bc5bd9d091f3d7785aa46b6">g_payload_state</a> = <a class="code hl_enumvalue" href="state_8h.html#a65441b5f61f2ab207d4cdaa9ead39eafa0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>;</div>
<div class="line">    <span class="comment">// Create jobs</span></div>
<div class="line">    <a class="code hl_function" href="steve_8c.html#aa1f662b5890cdc563739a6c3eed51686">schedule_recurring_job_secs</a>(<a class="code hl_define" href="heartbeat__job_8h.html#ae99ccbb91fd24cdd240f38706894b8b8">HEARTBEAT_JOB_NAME</a>, <a class="code hl_function" href="heartbeat__job_8c.html#a5a39a53ceb61fec283d89fcb0032a24b">heartbeat_telemetry_job</a>, <a class="code hl_define" href="heartbeat__job_8h.html#a3a3f723722d47da545b0da548764e6be">HEARTBEAT_TELEMETRY_DEFAULT_INTERVAL</a>);</div>
<div class="line">    ...</div>
<div class="line">    <a class="code hl_function" href="steve_8c.html#aa1f662b5890cdc563739a6c3eed51686">schedule_recurring_job_secs</a>(EXAMPLE_JOB_NAME, example_job, EXAMPLE_JOB_DEFAULT_INTERVAL)</div>
<div class="line">}</div>
<div class="ttc" id="aheartbeat__job_8c_html_a5a39a53ceb61fec283d89fcb0032a24b"><div class="ttname"><a href="heartbeat__job_8c.html#a5a39a53ceb61fec283d89fcb0032a24b">heartbeat_telemetry_job</a></div><div class="ttdeci">void heartbeat_telemetry_job(void *unused)</div><div class="ttdoc">Collects sensor information and transmits it as a heartbeat packet.</div><div class="ttdef"><b>Definition</b> heartbeat_job.c:26</div></div>
<div class="ttc" id="aheartbeat__job_8h_html_a3a3f723722d47da545b0da548764e6be"><div class="ttname"><a href="heartbeat__job_8h.html#a3a3f723722d47da545b0da548764e6be">HEARTBEAT_TELEMETRY_DEFAULT_INTERVAL</a></div><div class="ttdeci">#define HEARTBEAT_TELEMETRY_DEFAULT_INTERVAL</div><div class="ttdef"><b>Definition</b> heartbeat_job.h:4</div></div>
<div class="ttc" id="aheartbeat__job_8h_html_ae99ccbb91fd24cdd240f38706894b8b8"><div class="ttname"><a href="heartbeat__job_8h.html#ae99ccbb91fd24cdd240f38706894b8b8">HEARTBEAT_JOB_NAME</a></div><div class="ttdeci">#define HEARTBEAT_JOB_NAME</div><div class="ttdef"><b>Definition</b> heartbeat_job.h:3</div></div>
<div class="ttc" id="astate_8h_html_a65441b5f61f2ab207d4cdaa9ead39eafa0cb1b2c6a7db1f1084886c98909a3f36"><div class="ttname"><a href="state_8h.html#a65441b5f61f2ab207d4cdaa9ead39eafa0cb1b2c6a7db1f1084886c98909a3f36">INIT</a></div><div class="ttdeci">@ INIT</div><div class="ttdef"><b>Definition</b> state.h:5</div></div>
<div class="ttc" id="astate_8h_html_ab3c4a3401bc5bd9d091f3d7785aa46b6"><div class="ttname"><a href="state_8h.html#ab3c4a3401bc5bd9d091f3d7785aa46b6">g_payload_state</a></div><div class="ttdeci">payload_state_t g_payload_state</div><div class="ttdef"><b>Definition</b> state.h:11</div></div>
<div class="ttc" id="asteve_8c_html_a7eb0cd293c468c08d67c90a8ace5448c"><div class="ttname"><a href="steve_8c.html#a7eb0cd293c468c08d67c90a8ace5448c">initialize_steve</a></div><div class="ttdeci">void initialize_steve()</div><div class="ttdef"><b>Definition</b> steve.c:230</div></div>
<div class="ttc" id="asteve_8c_html_aa1f662b5890cdc563739a6c3eed51686"><div class="ttname"><a href="steve_8c.html#aa1f662b5890cdc563739a6c3eed51686">schedule_recurring_job_secs</a></div><div class="ttdeci">void schedule_recurring_job_secs(const char *job_name, job_func job_func_ptr, unsigned long secs_until_recur)</div><div class="ttdef"><b>Definition</b> steve.c:38</div></div>
<div class="ttc" id="asteve_8h_html_a598c2d1bb858ac5a4ca951addc49cb1e"><div class="ttname"><a href="steve_8h.html#a598c2d1bb858ac5a4ca951addc49cb1e">g_steve_context</a></div><div class="ttdeci">steve_context_t g_steve_context</div><div class="ttdoc">Global Scheduler Context.</div><div class="ttdef"><b>Definition</b> steve.h:35</div></div>
</div><!-- fragment --><p>Tasks can also be removed, their interval altered, and more. See the <code><a class="el" href="steve_8h.html" title="S.T.E.V.E (Scheduler Task for Executing Vital Events)">steve.h</a></code> header file for more info.</p>
<h1><a class="anchor" id="interacting-with-the-filesystem"></a>
Interacting with the Filesystem</h1>
<p>See the <code><a class="el" href="filesystem_8c.html">main/tasks/filesystem/filesystem.c</a></code> for more info on the API functions used to interact with the file system. These functions can be called by any task using the <code><a class="el" href="filesystem_8h.html" title="Handles file system operations and management.">filesystem.h</a></code> header file. There are already plenty of files that interact with the filesystem in the codebase, with <code>main/utilities/user_auth.c</code> being one of the better examples.</p>
<p>The filesystem interacts with the MRAM flash memory through the <code>main/drivers/diskio.c</code> device driver. This driver contains all the SPI read/write logic and should work with other SPI flash chips with some minor modifications (mainly check maximum storage size). The simulator also supports the filesystem through the use of a seperate RAM-disk device driver in <code>main/simulator/drivers/diskio.c</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
